

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Session 11: Coding Solution &#8212; Machine Learning Intensive</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/S11_SOL';</script>
    <link rel="canonical" href="https://kyle-paul.github.io/machine-learning-intensive/book/S11_SOL.html" />
    <link rel="shortcut icon" href="../_static/avatar.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Theory" href="Session%2011%20Revision.html" />
    <link rel="prev" title="Session 11: Q Learning" href="S11_LAB_Q_Learning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%201.html"><strong>Preclass Session 1: Representation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S1_ASM.html">Session 1: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S1_SOL.html">Session 1: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%201%20Revision.html"><strong>Session 1: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%202.html"><strong>Preclass Session 2: Linear Model</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S2_Lab_LinearModel.html">Session 2: Linear Model</a></li>

<li class="toctree-l1"><a class="reference internal" href="S2_ASM.html">Session 2: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S2_SOL.html">Session 2: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%202%20Revision.html"><strong>Session 2: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%203.html"><strong>Preclass Session 3: Recommender System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S3_Lab_RecSys.html">Sesion 3: Recommender System</a></li>

<li class="toctree-l1"><a class="reference internal" href="S3_ASM.html">Session 3: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S3_SOL.html">Session 3: Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%203%20Revision.html"><strong>Session 3: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%204.html"><strong>Preclass Session 4: NonLinear Predictor</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S4_Lab_NonLinearPredictors.html">Session 4: Nonlinear Predictors</a></li>
<li class="toctree-l1"><a class="reference internal" href="S4_ASM.html">Session 4: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S4_SOL.html">Session 4: Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%204%20Revision.html"><strong>Session 4: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%205.html"><strong>Preclass Session 5: Optimization</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S5_Lab_Optimization.html">Session 5: Optimization</a></li>

<li class="toctree-l1"><a class="reference internal" href="S5_ASM.html">Session 5: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S5_SOL.html">Session 5: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%205%20Revision.html"><strong>Session 5: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%206.html"><strong>Preclass Session 6: Metrics and Losses</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_Lab_Metrics%26Losses.html">Session 6: Metrics &amp; Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_ASM.html">Session 6: Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_SOL.html">Session 6: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Midterm%20Theory%20Test.html"><strong>Theory Midterm Test</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Midterm%20Theory%20Solution.html"><strong>Theory Midterm Solution</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S7_MidTerm_TEST.html">Session 7: Midterm Coding Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="S7_MidTerm_SOL.html">Session 7: Midterm Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%208.html"><strong>Preclass Session 8: Convolutional Neural Network</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S8_Lab_CNN.html">Session 8: Convolutional Neural Network</a></li>



<li class="toctree-l1"><a class="reference internal" href="S8_ASM.html">Session 8: Assignment</a></li>

<li class="toctree-l1"><a class="reference internal" href="S8_SOL.html">Session 8: Coding Solution</a></li>

<li class="toctree-l1"><a class="reference internal" href="Session%208%20Revision.html"><strong>Session 8: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%209.html"><strong>Preclass Session 9: Natural Language Processing</strong></a></li>


<li class="toctree-l1"><a class="reference internal" href="S9_LAB_RNN.html">Session 9 - Natural Language Processing</a></li>


<li class="toctree-l1"><a class="reference internal" href="S9_ASM.html">Session 9: Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S9_SOL.html">Session 9: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%209%20Revision.html"><strong>Session: 9 Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%2010.html"><strong>Preclass Session 10: MDP Planning</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S10_LAB_MDP_PLANNING.html">Session 10 - MDP Planning</a></li>

<li class="toctree-l1"><a class="reference internal" href="S10_ASM.html">Session 10: Assigment</a></li>

<li class="toctree-l1"><a class="reference internal" href="S10_SOL.html">Session 10: Coding Solution</a></li>

<li class="toctree-l1"><a class="reference internal" href="Session%2010%20Revision.html"><strong>Session 10: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%2011.html"><strong>Preclass Session 11: Reinforcement Learning</strong></a></li>


<li class="toctree-l1"><a class="reference internal" href="S11_LAB_Q_Learning.html">Session 11: Q Learning</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">Session 11: Coding Solution</a></li>


<li class="toctree-l1"><a class="reference internal" href="Session%2011%20Revision.html"><strong>Theory</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S12_FinalExam.html">Sesssion 12: Final Coding test</a></li>
<li class="toctree-l1"><a class="reference internal" href="Final%20Test%20Theory.html"><strong>Session 12: final theory test</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/kyle-paul/machine-learning-intensive/master?urlpath=tree/book/S11_SOL.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/kyle-paul/machine-learning-intensive/blob/master/book/S11_SOL.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive/edit/main/book/S11_SOL.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive/issues/new?title=Issue%20on%20page%20%2Fbook/S11_SOL.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/S11_SOL.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Session 11: Coding Solution</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Session 11: Coding Solution</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gioi-thieu-moi-truong-game-taxi">Giới thiệu môi trường game Taxi</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#q-learning">Q-Learning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-1">TODO 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xem-agent-choi-sau-khi-train">Xem Agent chơi sau khi Train</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="session-11-coding-solution">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Session 11: Coding Solution</a><a class="headerlink" href="#session-11-coding-solution" title="Permalink to this heading">#</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#session-11-coding-solution" id="id1">Session 11: Coding Solution</a></p></li>
<li><p><a class="reference internal" href="#gioi-thieu-moi-truong-game-taxi" id="id2">Giới thiệu môi trường game Taxi</a></p></li>
<li><p><a class="reference internal" href="#q-learning" id="id3">Q-Learning</a></p>
<ul>
<li><p><a class="reference internal" href="#todo-1" id="id4">TODO 1</a></p></li>
<li><p><a class="reference internal" href="#xem-agent-choi-sau-khi-train" id="id5">Xem Agent chơi sau khi Train</a></p></li>
</ul>
</li>
</ul>
</nav>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>!pip install gymnasium
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="gioi-thieu-moi-truong-game-taxi">
<h1><a class="toc-backref" href="#id2" role="doc-backlink">Giới thiệu môi trường game Taxi</a><a class="headerlink" href="#gioi-thieu-moi-truong-game-taxi" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import gymnasium as gym # thư viện tạo game
import matplotlib.pyplot as plt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>env = gym.make(&quot;Taxi-v3&quot;, render_mode=&quot;rgb_array&quot;)
env.reset() # must be called after creating
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>frame = env.render()
plt.imshow(frame)
plt.show()
</pre></div>
</div>
</div>
</div>
<p>Môi trường này giả lập việc taxi đón và trả khách.</p>
<blockquote>
<div><p>Khi episode bắt đầu, taxi sẽ xuất hiện ở vị trí ngẫu nhiên trên bản đồ (grid 5x5).</p>
</div></blockquote>
<ul class="simple">
<li><p>Các ô màu thể hiện vị trí mà khách hàng sẽ xuất hiện ngẫu nhiên. Taxi cần chạy đến ô có khách hàng để đón khách.</p></li>
<li><p>Các ô màu cũng thể hiện vị trí khách sạn (nơi trả khách) (có trường hợp địa điểm đón khách cũng là địa điểm trả khách), taxi cần chạy đến ô khách sạn trả khách.</p></li>
</ul>
<blockquote>
<div><p>Episode sẽ kết thúc khi <strong>taxi thực hiện hành động trả khách</strong>.</p>
</div></blockquote>
<p>Nếu ảnh game khó hình dung grid, bạn có thể tham khảo hình dưới</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">B</span> <span class="n">là</span> <span class="n">các</span> <span class="n">điểm</span> <span class="n">đón</span><span class="o">/</span><span class="n">trả</span> <span class="n">khách</span>
<span class="n">Các</span> <span class="n">ô</span> <span class="n">rỗng</span> <span class="n">là</span> <span class="n">vị</span> <span class="n">trí</span> <span class="n">taxi</span> <span class="n">có</span> <span class="n">thể</span> <span class="n">đi</span>
<span class="n">Kí</span> <span class="n">tự</span> <span class="o">|</span> <span class="n">và</span> <span class="p">:</span> <span class="n">ám</span> <span class="n">chỉ</span> <span class="n">lane</span> <span class="n">đường</span>

<span class="o">+---------+</span>
<span class="o">|</span><span class="n">R</span><span class="p">:</span> <span class="o">|</span> <span class="p">:</span> <span class="p">:</span><span class="n">G</span><span class="o">|</span>
<span class="o">|</span> <span class="p">:</span> <span class="o">|</span> <span class="p">:</span> <span class="p">:</span> <span class="o">|</span>
<span class="o">|</span> <span class="p">:</span> <span class="p">:</span> <span class="p">:</span> <span class="p">:</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">|</span> <span class="p">:</span> <span class="o">|</span> <span class="p">:</span> <span class="o">|</span>
<span class="o">|</span><span class="n">Y</span><span class="o">|</span> <span class="p">:</span> <span class="o">|</span><span class="n">B</span><span class="p">:</span> <span class="o">|</span>
<span class="o">+---------+</span>
</pre></div>
</div>
<p><strong>Agent có thể làm 6 hành động</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Đi xuống</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Đi lên</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> Sang phải</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> Sang trái</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code> Đón khách</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">5</span></code> Trả khách</p></li>
</ul>
<p><strong>Reward</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">+20</span></code> trả khách thành công</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-10</span></code> đón hoặc trả khách sai địa điểm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-1</span></code> nếu không thuộc 2 trường hợp trên (mỗi lần taxi di chuyển)</p></li>
</ul>
<p>Cùng tìm hiểu hệ thống các <code class="docutils literal notranslate"><span class="pre">State</span></code> trong môi trường này nhé</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>first_state = env.reset()
plt.imshow(env.render())
plt.show()
print()
print(f&quot;First state: {first_state}&quot;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(f&quot;Action Space: {env.action_space}&quot;)
print(f&quot;State Space: {env.observation_space}&quot;)
</pre></div>
</div>
</div>
</div>
<p>Game có tổng cộng 500 state: 25 vị trí taxi, 5 vị trí của khách (có 1 vị trí là “in taxi”) 4 vị trí khách sạn → <code class="docutils literal notranslate"><span class="pre">Q</span> <span class="pre">Table</span></code> là 1 ma trận có shape <code class="docutils literal notranslate"><span class="pre">(500,</span> <span class="pre">6)</span></code> (500 state, 6 action)</p>
<p>State đầu tiên (khi gọi <code class="docutils literal notranslate"><span class="pre">reset()</span></code> ) mà game trả về là 1 <code class="docutils literal notranslate"><span class="pre">tuple</span></code>. Bạn chỉ cần quan tâm con số đầu tiên trong <code class="docutils literal notranslate"><span class="pre">tuple</span></code> này thôi. Con số này là 1 số nguyên biểu diễn state hiện tại theo công thức sau</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">taxi_row_location</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">taxi_col_location</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">passenger_location</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">destination</span>
</pre></div>
</div>
<p>Trong đó, <code class="docutils literal notranslate"><span class="pre">passenger_location</span></code> và <code class="docutils literal notranslate"><span class="pre">destination</span></code> được đánh số như sau</p>
<p><code class="docutils literal notranslate"><span class="pre">passenger_locations</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Red</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Green</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> Yellow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> Blue</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4</span></code> In taxi</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">destinations</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> Red</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> Green</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> Yellow</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code> Blue</p></li>
</ul>
<p>Vì mỗi lần chạy sẽ khác nhau, bạn hãy tự kiểm tra lại công thức trên nhé. Ở lần chạy của giảng viên, state là <code class="docutils literal notranslate"><span class="pre">461</span></code> với ảnh render sau</p>
<p><img alt="" src="https://i.imgur.com/UWEw5um.png" /></p>
<p>Số <code class="docutils literal notranslate"><span class="pre">461</span></code> gồm:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_row_location</span> <span class="pre">=</span> <span class="pre">4</span></code> (góc tọa độ <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">0</span></code> ở trên bên trái)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_col_location</span> <span class="pre">=</span> <span class="pre">3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">passenger_location</span> <span class="pre">=</span> <span class="pre">0</span></code> (ô màu đỏ)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destination</span> <span class="pre">=</span> <span class="pre">1</span></code> (ô màu xanh)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">461</span> <span class="o">=</span> <span class="p">((</span><span class="n">taxi_row_location</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">taxi_col_location</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">passenger_location</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">destination</span>
</pre></div>
</div>
<p>Hàm <code class="docutils literal notranslate"><span class="pre">step(action)</span></code> của môi trường sẽ trả về lần lượt các thông tin sau</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next_state</span></code> số nguyên biểu diễn state tiếp theo</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reward</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">terminal</span></code> gameover hay không</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">truncate</span></code> KHÔNG DÙNG. Game được cài đặt sẽ kết thúc sau 200 steps (tương tự  biến <code class="docutils literal notranslate"><span class="pre">max_steps</span></code> trong bài lab, phần bên dưới ta sẽ thực hành q-learning với <code class="docutils literal notranslate"><span class="pre">max_steps=99</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">info</span></code> KHÔNG DÙNG</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># đối với first_state lấy ra từ env.reset()
# thì first_state là tuple
# số nguyên biểu diễn state là phần từ đầu tiên trong tuple
first_state = env.reset()
print(first_state[0])
# to render
# plt.imshow(env.render())
# plt.show()

# next_state khi gọi step là 1 số nguyên luôn chứ không phải tuple
next_state, reward, terminal, _, _ = env.step(1)
# to render
# plt.imshow(env.render())
# plt.show()
print(next_state, reward, terminal)
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="q-learning">
<h1><a class="toc-backref" href="#id3" role="doc-backlink">Q-Learning</a><a class="headerlink" href="#q-learning" title="Permalink to this heading">#</a></h1>
<section id="todo-1">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">TODO 1</a><a class="headerlink" href="#todo-1" title="Permalink to this heading">#</a></h2>
<p>Cho sẵn các thông số sau</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span><span class="p">))</span> <span class="c1"># 500, 6</span>

<span class="n">episodes</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># số lượng episode cần huấn luyện</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># learning rate</span>
<span class="n">max_steps</span> <span class="o">=</span> <span class="mi">99</span>  <span class="c1"># Số step tối đa để gameover</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># discount factor</span>

<span class="c1"># thông số của thuật toán epsilon greedy with decay</span>
<span class="c1"># epsilon sau khi kết thúc episode = epsilon * epsilon_decay_rate</span>
<span class="n">initial_epsilon</span> <span class="o">=</span> <span class="mf">1.0</span>  
<span class="n">min_epsilon</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">epsilon_decay_rate</span> <span class="o">=</span> <span class="mf">0.9</span>

<span class="c1"># Evaluation</span>
<span class="c1"># Mỗi 1000 episode, bạn cho taxi chơi theo greedy-policy 50 lần và thống kê reward</span>
<span class="n">evaluate_at_episode</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">num_eval</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>
</div>
<p>Dùng <strong>thuật toán Q-Learning</strong> để giải bài toán này.</p>
<p>Bạn có thể tham khảo gợi ý bên dưới, khuyến khích học viên làm theo để tự suy nghĩ xem nên thiết kế các hàm như thế nào. Khi viết hàm, bạn nên hạn chế gọi biến GLOBAL mà nên truyền các biến này vào làm tham số của hàm</p>
<p><strong>Gợi ý</strong></p>
<p>Để code đẹp, bạn nên viết các hàm hỗ trợ sau:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">follow_policy</span></code> dùng <code class="docutils literal notranslate"><span class="pre">argmax</span></code> trên <code class="docutils literal notranslate"><span class="pre">q_table</span></code> để đi theo policy tốt nhất</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon_greedy</span></code> nếu các action có cùng <code class="docutils literal notranslate"><span class="pre">q_values</span></code>, bạn có thể dùng argmax cho đơn giản (gọi hàm <code class="docutils literal notranslate"><span class="pre">follow_policy</span></code> bên trên)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_q</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">decay_epsilon</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train_one_episode</span></code> hàm để huấn luyện Agent 1 lần</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evaluate_agent</span></code> hàm để đánh giá Agent (xem thông số bên trên)</p></li>
</ul>
<p>Sau khi viết xong các hàm trên, training loop của bạn nhìn sẽ rất đẹp</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dùng để render progress bar khi train</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="o">...</span>
<span class="n">reward_history</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">episode</span><span class="p">)):</span>
  <span class="n">average_reward</span> <span class="o">=</span> <span class="n">train_one_episode</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="c1"># có thể vẽ chart xem sự thay đổi của reward sau khi train</span>
  <span class="n">reward_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">average_reward</span><span class="p">)</span>
  <span class="n">current_epsilon</span> <span class="o">=</span> <span class="n">decay_epsilon</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="c1"># evaluate</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">evaluate_at_episode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">eval_average_reward</span><span class="p">,</span> <span class="n">num_loss</span> <span class="o">=</span> <span class="n">evaluate_agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluate after episode </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Average reward: </span><span class="si">{</span><span class="n">eval_average_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Loss          : </span><span class="si">{</span><span class="n">num_loss</span><span class="si">}</span><span class="s2">/50&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># YOUR SOLUTION
</pre></div>
</div>
</div>
</div>
</section>
<section id="xem-agent-choi-sau-khi-train">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Xem Agent chơi sau khi Train</a><a class="headerlink" href="#xem-agent-choi-sau-khi-train" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import cv2

frames = []
# chơi 10 episode và thu thập các frame ảnh
for i in range(10):
  state = env.reset()[0]
  # lưu lại frame ảnh
  # resize để giảm kích thước cho nhẹ
  frame = env.render()
  frame = env.render()
  new_size = int(frame.shape[1] * 0.5), int(frame.shape[0] * 0.5)
  frame = cv2.resize(frame, new_size)
  frames.append(frame)
  step = 0
  while True:
    action = np.argmax(q_table[state])
    state, reward, terminal, _, _ = env.step(action)
    frame = env.render()
    new_size = int(frame.shape[1] * 0.5), int(frame.shape[0] * 0.5)
    frame = cv2.resize(frame, new_size)
    frames.append(frame)
    step += 1
    if terminal or step &gt; 200:
      break
</pre></div>
</div>
</div>
</div>
<p>Chạy cell bên dưới để tạo animation, bạn cần xóa animation này trước khi nộp bài</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import matplotlib.animation as anim
from IPython.display import HTML
import matplotlib.pyplot as plt

limit_frames = frames[:100]
plt.figure(figsize=(limit_frames[0].shape[1] / 18.0, limit_frames[0].shape[0] / 18.0), dpi = 72)
patch = plt.imshow(limit_frames[0])
plt.axis(&#39;off&#39;)
animate = lambda i: patch.set_data(limit_frames[i])
ani = anim.FuncAnimation(plt.gcf(), animate, frames=len(limit_frames), interval = 300)
HTML(ani.to_jshtml())
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="S11_LAB_Q_Learning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Session 11: Q Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="Session%2011%20Revision.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Theory</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Session 11: Coding Solution</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#gioi-thieu-moi-truong-game-taxi">Giới thiệu môi trường game Taxi</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#q-learning">Q-Learning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#todo-1">TODO 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xem-agent-choi-sau-khi-train">Xem Agent chơi sau khi Train</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle Paul
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>