

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Session 4: Solution &#8212; Machine Learning Intensive</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/S4_SOL';</script>
    <link rel="canonical" href="https://kyle-paul.github.io/machine-learning-intensive/book/S4_SOL.html" />
    <link rel="shortcut icon" href="../_static/avatar.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Session 4: Revision" href="Session%204%20Revision.html" />
    <link rel="prev" title="Session 4: Assigment" href="S4_ASM.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%201.html"><strong>Preclass Session 1: Representation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S1_ASM.html">Session 1: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S1_SOL.html">Session 1: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%201%20Revision.html"><strong>Session 1: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%202.html"><strong>Preclass Session 2: Linear Model</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S2_Lab_LinearModel.html">Session 2: Linear Model</a></li>

<li class="toctree-l1"><a class="reference internal" href="S2_ASM.html">Session 2: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S2_SOL.html">Session 2: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%202%20Revision.html"><strong>Session 2: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%203.html"><strong>Preclass Session 3: Recommender System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S3_Lab_RecSys.html">Sesion 3: Recommender System</a></li>

<li class="toctree-l1"><a class="reference internal" href="S3_ASM.html">Session 3: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S3_SOL.html">Session 3: Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%203%20Revision.html"><strong>Session 3: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%204.html"><strong>Preclass Session 4: NonLinear Predictor</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S4_Lab_NonLinearPredictors.html">Session 4: Nonlinear Predictors</a></li>
<li class="toctree-l1"><a class="reference internal" href="S4_ASM.html">Session 4: Assigment</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Session 4: Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%204%20Revision.html"><strong>Session 4: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%205.html"><strong>Preclass Session 5: Optimization</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S5_Lab_Optimization.html">Session 5: Optimization</a></li>

<li class="toctree-l1"><a class="reference internal" href="S5_ASM.html">Session 5: Assigment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S5_SOL.html">Session 5: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%205%20Revision.html"><strong>Session 5: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%206.html"><strong>Preclass Session 6: Metrics and Losses</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_Lab_Metrics%26Losses.html">Session 6: Metrics &amp; Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_ASM.html">Session 6: Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S6_SOL.html">Session 6: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Midterm%20Theory%20Test.html"><strong>Theory Midterm Test</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Midterm%20Theory%20Solution.html"><strong>Theory Midterm Solution</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S7_MidTerm_TEST.html">Session 7: Midterm Coding Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="S7_MidTerm_SOL.html">Session 7: Midterm Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%208.html"><strong>Preclass Session 8: Convolutional Neural Network</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S8_Lab_CNN.html">Session 8: Convolutional Neural Network</a></li>



<li class="toctree-l1"><a class="reference internal" href="S8_ASM.html">Session 8: Assignment</a></li>

<li class="toctree-l1"><a class="reference internal" href="S8_SOL.html">Session 8: Coding Solution</a></li>

<li class="toctree-l1"><a class="reference internal" href="Session%208%20Revision.html"><strong>Session 8: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%209.html"><strong>Preclass Session 9: Natural Language Processing</strong></a></li>


<li class="toctree-l1"><a class="reference internal" href="S9_LAB_RNN.html">Session 9 - Natural Language Processing</a></li>


<li class="toctree-l1"><a class="reference internal" href="S9_ASM.html">Session 9: Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="S9_SOL.html">Session 9: Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Session%209%20Revision.html"><strong>Session: 9 Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%2010.html"><strong>Preclass Session 10: MDP Planning</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S10_LAB_MDP_PLANNING.html">Session 10 - MDP Planning</a></li>

<li class="toctree-l1"><a class="reference internal" href="S10_ASM.html">Session 10: Assigment</a></li>

<li class="toctree-l1"><a class="reference internal" href="S10_SOL.html">Session 10: Coding Solution</a></li>

<li class="toctree-l1"><a class="reference internal" href="Session%2010%20Revision.html"><strong>Session 10: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Preclass%20Session%2011.html"><strong>Preclass Session 11: Reinforcement Learning</strong></a></li>


<li class="toctree-l1"><a class="reference internal" href="S11_LAB_Q_Learning.html">Session 11: Q Learning</a></li>


<li class="toctree-l1"><a class="reference internal" href="S11_SOL.html">Session 11: Coding Solution</a></li>


<li class="toctree-l1"><a class="reference internal" href="Session%2011%20Revision.html"><strong>Session 11: Revision</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="S12_FinalExam_TEST.html">Sesssion 12: Final Coding Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="S12_FinalExam_SOL.html">Sesssion 12: Final Coding Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Final%20Test%20Theory.html"><strong>Session 12: final theory test</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/kyle-paul/machine-learning-intensive/master?urlpath=tree/book/S4_SOL.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/kyle-paul/machine-learning-intensive/blob/master/book/S4_SOL.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive/edit/main/book/S4_SOL.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kyle-paul/machine-learning-intensive/issues/new?title=Issue%20on%20page%20%2Fbook/S4_SOL.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/S4_SOL.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Session 4: Solution</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mnist-dataset">1. MNIST Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-dataset">Prepare the Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-train-the-model">Build and train the model</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="session-4-solution">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Session 4: Solution</a><a class="headerlink" href="#session-4-solution" title="Permalink to this heading">#</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#session-4-solution" id="id1">Session 4: Solution</a></p>
<ul>
<li><p><a class="reference internal" href="#mnist-dataset" id="id2">1. MNIST Dataset</a></p>
<ul>
<li><p><a class="reference internal" href="#prepare-the-dataset" id="id3">Prepare the Dataset</a></p></li>
<li><p><a class="reference internal" href="#data-preprocessing" id="id4">Data Preprocessing</a></p></li>
<li><p><a class="reference internal" href="#build-and-train-the-model" id="id5">Build and train the model</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="mnist-dataset">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">1. MNIST Dataset</a><a class="headerlink" href="#mnist-dataset" title="Permalink to this heading">#</a></h2>
<section id="prepare-the-dataset">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Prepare the Dataset</a><a class="headerlink" href="#prepare-the-dataset" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import numpy as np
import matplotlib.pyplot as plt
# Function to download dataset
from tensorflow.keras.datasets import mnist
</pre></div>
</div>
</div>
</div>
<p><strong>Download data</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(x_train, y_train), (x_test, y_test) = mnist.load_data()
print(&#39;Shape of x_train:&#39;,x_train.shape)
print(&#39;Shape of y_train:&#39;,y_train.shape)
print(&#39;-&#39;*10)
print(&#39;Shape of x_test:&#39;,x_test.shape)
print(&#39;Shape of y_test:&#39;,y_test.shape)
print(&#39;-&#39;*10)
print(&#39;Labels:&#39;,np.unique(y_train))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of x_train: (60000, 28, 28)
Shape of y_train: (60000,)
----------
Shape of x_test: (10000, 28, 28)
Shape of y_test: (10000,)
----------
Labels: [0 1 2 3 4 5 6 7 8 9]
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preprocessing">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Data Preprocessing</a><a class="headerlink" href="#data-preprocessing" title="Permalink to this heading">#</a></h3>
<p>Explore the data in <code class="docutils literal notranslate"><span class="pre">x_train</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&#39;x_train data type:&#39;, x_train.dtype)
print(&#39;Min of x_train:&#39;, x_train.min())
print(&#39;Max of x_train:&#39;, x_train.max())
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x_train data type: uint8
Min of x_train: 0
Max of x_train: 255
</pre></div>
</div>
</div>
</div>
<p>Image data usually has a data type of ‘uint8’ and the value of each pixel is approximately <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">255]</span></code></p>
<p>In addition, image data can also be <code class="docutils literal notranslate"><span class="pre">float</span></code> with the value per pixel being around <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code></p>
<p>The most common step of pre-processing image data is to convert the data type to <code class="docutils literal notranslate"><span class="pre">float</span></code> and scale the pixel value from <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">255]</span></code> to <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># /255.0 stands for converting the data type of images to float and dividing 255</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">images</span> <span class="o">/</span> <span class="mf">255.0</span>
</pre></div>
</div>
<p>The above data preprocessing formula is also known as <strong>Min Max Scaler</strong>
$<span class="math notranslate nohighlight">\(
X_\text{scaled} = \frac{X - min(X)}{max(X) - min(X)}
\)</span>$</p>
<p>Since the minimum pixel value is 0 and the maximum value is 255, the above formula is reduced to:
$<span class="math notranslate nohighlight">\(
X_\text{scaled} = \frac{X}{255.0}
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x_train = x_train / 255.0
x_test = x_test / 255.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># one-hot encoding
from tensorflow.keras.utils import to_categorical

y_train_encode = to_categorical(y_train, num_classes=10)
y_test_encode = to_categorical(y_test, num_classes=10)
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-and-train-the-model">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Build and train the model</a><a class="headerlink" href="#build-and-train-the-model" title="Permalink to this heading">#</a></h3>
<p><strong>Note 1</strong></p>
<ul>
<li><p>The Deep Fully Connected Neural Network model only accepts input that is a 2-dimensional Tensor dataset, i.e. has <strong>shape=(m, n)</strong></p></li>
<li><p>Meanwhile, each sample of our data is 1 image with a shape (28, 28), i.e. the data set will be in the form of a 3-dimensional Tensor, <strong>shape=(m,28,28)</strong></p></li>
<li><p>Therefore, we need <strong>Flatten</strong> dataset.</p>
<p><img alt="flatten" src="https://www.w3resource.com/w3r_images/numpy-manipulation-ndarray-flatten-function-image-1.png" /></p>
</li>
<li><p>It is clear that <strong>Flatten</strong> datasets cause each image to lose its color structure as well as the semantics of the image. Later we will learn another architecture that helps process image-style data better (no need <strong>Flatten</strong>)</p></li>
<li><p>To implement <strong>Flatten</strong>, we use the layer <strong>Flatten</strong> available in Tensorflow</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Flatten</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="c1"># The first layer in the model always has the parameter input_shape</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="c1"># ... mlp here</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Note 2</strong></p>
<p><strong>Sparse Categorical Crossentropy vs. Categorical Crossentropy</strong></p>
<ul class="simple">
<li><p>When using loss function <code class="docutils literal notranslate"><span class="pre">sparse_categorical_crossentropy</span></code>, we don’t need to perform <strong>One Hot Encoding</strong>, which means label would be in the form <code class="docutils literal notranslate"><span class="pre">[0,1,1,2,</span> <span class="pre">...</span> <span class="pre">]</span></code>.</p></li>
<li><p>When using loss function <code class="docutils literal notranslate"><span class="pre">categorical_crossentropy</span></code>, we need to perform <strong>One Hot Encoding</strong>.</p></li>
</ul>
<p>There are 2 directions for you to approach this problem</p>
<ol class="arabic simple">
<li><p>Flatten data and use MLP network to directly solve this problem</p></li>
<li><p>Flatten data, use PCA to extract the feature and pass it over the MLP network to solve. Note in this way, you need to use PCA to extract features on the Test set and then put through the model to <code class="docutils literal notranslate"><span class="pre">predict</span> <span class="pre">/</span> <span class="pre">evaluate</span></code></p></li>
</ol>
<p>Please do both steps above in turn, remember to compare the quality of this new model with the old one in lesson 2.</p>
<p><strong>1. Flatten data and use MLP network to directly solve this problem</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Input, Dense, Flatten, Activation
from tensorflow.random import set_seed
from tensorflow.keras.backend import clear_session

clear_session()
set_seed(42)
np.random.seed(42)

# YOUR SOLUTION
model = Sequential()

# input layer
model.add(Input(shape=(x_train.shape[1:])))
model.add(Flatten())

# mlp
model.add(Dense(32, activation=&#39;relu&#39;, name=&#39;layer_1&#39;))
model.add(Dense(64, activation=&#39;relu&#39;, name=&#39;layer_2&#39;))
model.add(Dense(128, activation=&#39;relu&#39;, name=&#39;layer_3&#39;))
model.add(Dense(64, activation=&#39;relu&#39;, name=&#39;layer_4&#39;))
model.add(Dense(32, activation=&#39;relu&#39;, name=&#39;layer_5&#39;))
model.add(Dense(10, activation=&#39;softmax&#39;, name=&#39;output_layer&#39;))
model.summary()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 flatten (Flatten)           (None, 784)               0         
                                                                 
 layer_1 (Dense)             (None, 32)                25120     
                                                                 
 layer_2 (Dense)             (None, 64)                2112      
                                                                 
 layer_3 (Dense)             (None, 128)               8320      
                                                                 
 layer_4 (Dense)             (None, 64)                8256      
                                                                 
 layer_5 (Dense)             (None, 32)                2080      
                                                                 
 output_layer (Dense)        (None, 10)                330       
                                                                 
=================================================================
Total params: 46,218
Trainable params: 46,218
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model.compile(loss=&quot;categorical_crossentropy&quot;, optimizer=&quot;adam&quot;, metrics=&quot;accuracy&quot;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>history = model.fit(x_train, y_train_encode, epochs=20, verbose=1)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1875/1875 [==============================] - 13s 4ms/step - loss: 0.3236 - accuracy: 0.9011
Epoch 2/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.1528 - accuracy: 0.9538
Epoch 3/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.1190 - accuracy: 0.9638
Epoch 4/20
1875/1875 [==============================] - 7s 3ms/step - loss: 0.1008 - accuracy: 0.9689
Epoch 5/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0879 - accuracy: 0.9725
Epoch 6/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0793 - accuracy: 0.9755
Epoch 7/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0700 - accuracy: 0.9782
Epoch 8/20
1875/1875 [==============================] - 7s 3ms/step - loss: 0.0647 - accuracy: 0.9793
Epoch 9/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0567 - accuracy: 0.9818
Epoch 10/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0540 - accuracy: 0.9823
Epoch 11/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0498 - accuracy: 0.9842
Epoch 12/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0458 - accuracy: 0.9855
Epoch 13/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0454 - accuracy: 0.9863
Epoch 14/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0396 - accuracy: 0.9871
Epoch 15/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0390 - accuracy: 0.9876
Epoch 16/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0369 - accuracy: 0.9880
Epoch 17/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0364 - accuracy: 0.9886
Epoch 18/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0333 - accuracy: 0.9895
Epoch 19/20
1875/1875 [==============================] - 8s 4ms/step - loss: 0.0315 - accuracy: 0.9897
Epoch 20/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0313 - accuracy: 0.9899
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model.evaluate(x_test, y_test_encode)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>313/313 [==============================] - 1s 3ms/step - loss: 0.1212 - accuracy: 0.9705
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.12124622613191605, 0.9704999923706055]
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Flatten data, use PCA to extract the feature and pass it over the MLP network to solve. Note in this way, you need to use PCA to extract features on the Test set and then put it through the model to predict / evaluate</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># flatten
x_train_flatten = x_train.reshape(x_train.shape[0], x_train.shape[1] * x_train.shape[2])
x_test_flatten = x_test.reshape(x_test.shape[0], x_test.shape[1] * x_test.shape[2])

# apply pca
from sklearn.decomposition import PCA
pca = PCA(0.99)
x_train_pca = pca.fit_transform(x_train_flatten)
x_test_pca = pca.transform(x_test_flatten)
print(pca.n_components_)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>331
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>clear_session()
set_seed(42)
np.random.seed(42)

model_pca = Sequential()
# input layer
model_pca.add(Input(shape=(x_train_pca.shape[1:])))
# mlp
model_pca.add(Dense(32, activation=&#39;relu&#39;, name=&#39;layer_1&#39;))
model_pca.add(Dense(64, activation=&#39;relu&#39;, name=&#39;layer_2&#39;))
model_pca.add(Dense(128, activation=&#39;relu&#39;, name=&#39;layer_3&#39;))
model_pca.add(Dense(64, activation=&#39;relu&#39;, name=&#39;layer_4&#39;))
model_pca.add(Dense(32, activation=&#39;relu&#39;, name=&#39;layer_5&#39;))
model_pca.add(Dense(10, activation=&#39;softmax&#39;, name=&#39;output_layer&#39;))
model_pca.summary()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 layer_1 (Dense)             (None, 32)                10624     
                                                                 
 layer_2 (Dense)             (None, 64)                2112      
                                                                 
 layer_3 (Dense)             (None, 128)               8320      
                                                                 
 layer_4 (Dense)             (None, 64)                8256      
                                                                 
 layer_5 (Dense)             (None, 32)                2080      
                                                                 
 output_layer (Dense)        (None, 10)                330       
                                                                 
=================================================================
Total params: 31,722
Trainable params: 31,722
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_pca.compile(loss=&quot;categorical_crossentropy&quot;, optimizer=&quot;adam&quot;, metrics=&quot;accuracy&quot;)
history_2 = model_pca.fit(x_train_pca, y_train_encode, epochs=20, verbose=1)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1875/1875 [==============================] - 9s 4ms/step - loss: 0.8175 - accuracy: 0.7866
Epoch 2/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.2398 - accuracy: 0.9302
Epoch 3/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.1730 - accuracy: 0.9488
Epoch 4/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.1391 - accuracy: 0.9580
Epoch 5/20
1875/1875 [==============================] - 8s 4ms/step - loss: 0.1135 - accuracy: 0.9666
Epoch 6/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.1038 - accuracy: 0.9689
Epoch 7/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0921 - accuracy: 0.9727
Epoch 8/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0796 - accuracy: 0.9761
Epoch 9/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0729 - accuracy: 0.9778
Epoch 10/20
1875/1875 [==============================] - 8s 4ms/step - loss: 0.0710 - accuracy: 0.9793
Epoch 11/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0661 - accuracy: 0.9811
Epoch 12/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0609 - accuracy: 0.9815
Epoch 13/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0563 - accuracy: 0.9836
Epoch 14/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0539 - accuracy: 0.9842
Epoch 15/20
1875/1875 [==============================] - 6s 3ms/step - loss: 0.0537 - accuracy: 0.9854
Epoch 16/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0551 - accuracy: 0.9850
Epoch 17/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0474 - accuracy: 0.9869
Epoch 18/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0454 - accuracy: 0.9871
Epoch 19/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0483 - accuracy: 0.9870
Epoch 20/20
1875/1875 [==============================] - 7s 4ms/step - loss: 0.0426 - accuracy: 0.9879
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>model_pca.evaluate(x_test_pca, y_test_encode)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>313/313 [==============================] - 1s 3ms/step - loss: 0.1941 - accuracy: 0.9595
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.19406358897686005, 0.9595000147819519]
</pre></div>
</div>
</div>
</div>
<p>With the mlp model (both pca or not), the accuracy is higher both on the train set and test set and the loss is also lower than the model in lesson 2 in both train set and test set</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="S4_ASM.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Session 4: Assigment</p>
      </div>
    </a>
    <a class="right-next"
       href="Session%204%20Revision.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Session 4: Revision</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mnist-dataset">1. MNIST Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-dataset">Prepare the Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-train-the-model">Build and train the model</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle Paul
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>